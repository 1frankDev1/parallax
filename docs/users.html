<!DOCTYPE html>  
<html lang="es">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Administracion de Usuarios</title>  
    <link rel="stylesheet" href="./assets/css/badge.css">  
    <style>  
        body {  
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;  
            background: #2c2c2c;  
            color: #f0f0f0;  
            margin: 0;  
            padding: 20px;  
            display: flex;  
            justify-content: center;  
            align-items: center;  
            flex-direction: column;  
        }  
  
        .container {  
            width: 100%;  
            max-width: 1200px;  
            animation: fadeIn 0.5s ease-in-out;  
        }  
        .container .logo{
          width: 100%;
          height: 100px;
          margin: auto;
          text-align: center;
        }
        .logo img{
          width: 200px;
        }
  
        @keyframes fadeIn {  
            from { opacity: 0; transform: translateY(-20px); }  
            to { opacity: 1; transform: translateY(0); }  
        }  
  
        h1 {  
            color: #00bcd4;  
            text-align: center;  
        }  
  
        table {  
            width: 100%;  
            border-collapse: collapse;  
            margin-top: 20px;  
            background-color: #3d3d3d;  
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);  
            border-radius: 8px;  
            overflow: hidden;  
            color: white;
        }  
  
        th, td {  
            padding: 15px;  
            text-align: left;  
        }  
  
        th {  
            background-color: #4a4a4a;  
        }  
  
        tr:nth-child(even) {  
            background-color: #424242;  
        }  
          
        .form-container {  
            margin-top: 40px;  
            background-color: #3d3d3d;  
            padding: 30px;  
            border-radius: 8px;  
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);  
        }  
  
        .form-container h2 {  
            margin-top: 0;  
            color: #00bcd4;  
            text-align: center;  
        }  
  
        .form-container input, .form-container select, .form-container button {  
            width: 100%;  
            padding: 12px;  
            margin-top: 15px;  
            border-radius: 5px;  
            border: 1px solid #555;  
            box-sizing: border-box;  
            background-color: #555;  
            color: #f0f0f0;  
            transition: all 0.3s ease;  
        }  
  
        .form-container input:focus, .form-container select:focus {  
            border-color: #00bcd4;  
            box-shadow: 0 0 8px rgba(0, 188, 212, 0.5);  
        }  
  
        .form-container button {  
            background-color: #ff8c00;  
            cursor: pointer;  
            font-weight: bold;  
            width: 50%;  
            display: block;  
            margin: 20px auto 0;  
        }  
  
        .form-container button:hover {  
            background-color: #e67e00;  
        }  
          
        .action-buttons button {  
            padding: 8px 12px;  
            border: none;  
            border-radius: 5px;  
            cursor: pointer;  
            margin-right: 5px;  
        }  
  
        .edit-btn { background-color: #ff8c00; color: white; }  
        .delete-btn { background-color: #f44336; color: white; }  
  
        .modal {  
            position: fixed;  
            top: 0;  
            left: 0;  
            width: 100%;  
            height: 100%;  
            background-color: rgba(0,0,0,0.7);  
            display: flex;  
            justify-content: center;  
            align-items: center;  
            opacity: 0;  
            visibility: hidden;  
            transition: opacity 0.3s, visibility 0.3s;  
        }  
  
        .modal.visible {  
            opacity: 1;  
            visibility: visible;  
        }  
  
        .modal-content {  
            background-color: #3d3d3d;  
            padding: 30px;  
            border-radius: 8px;  
            width: 90%;  
            max-width: 400px;  
            text-align: center;  
            transform: scale(0.9);  
            transition: transform 0.3s;  
        }  
  
        .modal.visible .modal-content {  
            transform: scale(1);  
        }  
  
        .modal-content h2 { color: #00bcd4; }  
        .modal-content input, .modal-content select { width: 100%; padding: 12px; margin-top: 15px; border-radius: 5px; border: 1px solid #555; background-color: #555; color: #f0f0f0; }  
        .modal-content button { width: 100%; padding: 12px; margin-top: 20px; border-radius: 5px; border: none; cursor: pointer; }  
        .save-btn { background-color: #ff8c00; color: white; }  
        .cancel-btn { background-color: #f44336; color: white; margin-top: 10px; }  
  
        a { color: #00bcd4; text-decoration: none; display: inline-block; margin-bottom: 20px; }  
  
        /* Estilos para el Popup */  
        .popup {  
            position: fixed;  
            top: 20px;  
            right: -400px;  
            width: 280px;  
            padding: 20px;  
            background-color: #333;  
            color: white;  
            border-left: 5px solid #ff8c00;  
            border-radius: 5px;  
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);  
            transition: right 0.5s ease-in-out;  
            z-index: 1000;  
        }  
        .popup.show { right: 20px; }  
        .popup.error { border-left-color: #f44336; }  
    </style>  
</head>  
<body>  
    <div id="popup" class="popup"></div>  
  <!-- ICONO Y BADGE (sin barra, con margen propio) --> 
<img id="login-icon" class="login-icon" src="./assets/img/user.svg"> 
 
  <!-- Placa del usuario --> 
<div id="user-badge" class="user-badge hidden" style="position: fixed;"> 
  <div id="badge-username"></div> 
  <div id="badge-role"></div> 
</div> 
 
<!-- Menú ahora fuera del badge --> 
<div id="badge-menu" class="hidden"> 
  <button id="logout-btn" class="logout-btn">Cerrar sesión</button> 
</div> 
 
 
<!-- PANEL DE LOGIN --> 
<div id="login-panel" class="login-panel hidden"> 
 
  <h3>Iniciar sesión</h3> 
 
  <input id="user" class="input" placeholder="Usuario"> 
  <input id="pass" class="input" type="password" placeholder="Contraseña"> 
 
  <button id="login-btn" class="login-btn">Entrar</button> 
 
  <!-- Estado del login --> 
  <div id="login-status" class="status"></div> 
</div> 
 
<!-- TU DRAWER --> 
<menutech-drawer id="main-drawer" class="hidden"></menutech-drawer> 
 
 
  <!-- NAVBAR NEOMÓRFICO INFERIOR --> 
<div class="neo-nav-container"> 
    <button id="neoNavBack" class="neo-nav-btn"> 
        <svg viewBox="0 0 24 24" class="neo-nav-icon"> 
            <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" 
                  fill="none" stroke-linecap="round" stroke-linejoin="round"/> 
        </svg> 
    </button> 
 
    <button id="neoNavHome" class="neo-nav-btn"> 
        <svg viewBox="0 0 24 24" class="neo-nav-icon"> 
            <path d="M3 11l9-7 9 7v8a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-4H9v4a2  
                     2 0 0 1-2 2H5a2 2 0 0 1-2-2z" 
                  stroke="currentColor" stroke-width="2" fill="none" 
                  stroke-linecap="round" stroke-linejoin="round"/> 
        </svg> 
    </button> 
</div> 
  <menutech-themes></menutech-themes> 
  <menutech-chatbot></menutech-chatbot> 
    <div class="container">  
      <div class="logo"><img src="https://menutech.services/assets/img/logomt.png"/>  </div>
        <div id="user-list">  
            <table>  
                <thead>  
                    <tr>  
                        <th>Usuario</th>  
                        <th>Contraseña</th>  
                        <th>Rol</th>  
                        <th>Acciones</th>  
                    </tr>  
                </thead>  
                <tbody id="user-table-body">  
                    <!-- Las filas de usuarios se insertarán aquí -->  
                </tbody>  
            </table>  
        </div>  
  
        <div class="form-container">  
            <h2>Añadir Nuevo Usuario</h2>  
            <form id="add-user-form">  
                <input type="text" id="new-username" placeholder="Nombre de usuario" required>  
                <input type="password" id="new-password" placeholder="Contraseña" required>  
                <select id="new-role" required></select>  
                <button type="submit">Añadir Usuario</button>  
            </form>  
        </div>  
    </div>  
  
    <!-- Modal para editar contraseña -->  
    <div id="edit-modal" class="modal">  
        <div class="modal-content">  
            <h2 id="modal-title">Editar Usuario</h2>  
            <input type="text" id="modal-username" placeholder="Nombre de usuario" required>  
            <input type="password" id="modal-password" placeholder="Nueva Contraseña" required>  
            <select id="modal-role" required></select>  
            <button id="modal-save-btn" class="save-btn">Guardar</button>  
            <button id="modal-cancel-btn" class="cancel-btn">Cancelar</button>  
        </div>  
    </div>  
  
    <!-- Modal de Confirmación para Eliminar -->  
    <div id="confirm-modal" class="modal">  
        <div class="modal-content">  
            <h2 id="confirm-title">Confirmar Eliminación</h2>  
            <p id="confirm-text"></p>  
            <button id="confirm-yes-btn" class="save-btn">Sí, Eliminar</button>  
            <button id="confirm-no-btn" class="cancel-btn">No, Cancelar</button>  
        </div>  
    </div>  
     <script> 
  // Botón Atrás 
  const neoNavBack = document.getElementById("neoNavBack"); 
  if (neoNavBack) { 
      neoNavBack.addEventListener("click", () => { 
          if (window.history.length > 1) window.history.back(); 
      }); 
  } 
 
  // Botón Inicio 
  const neoNavHome = document.getElementById("neoNavHome"); 
  if (neoNavHome) { 
      neoNavHome.addEventListener("click", () => { 
          window.location.href = "index.html"; // Cambia por tu ruta principal 
      }); 
  } 
</script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tiny-animate/1.1.0/tinyanimate.min.js"></script> 
  <script src="./assets/js/badge.js"></script> 
  <script src="https://menutech.xyz/menutechUI.min.js"></script> 
  <script src="./assets/js/renderer.js"></script> 
    <script src="./assets/js/users.js" type="module"></script>  
    <script>
    // Corrección para asegurar que el clic en el badge funcione en esta página específica.
    document.addEventListener('DOMContentLoaded', () => {
        // Usamos un pequeño retraso para asegurar que todos los demás scripts, incluido renderer.js,
        // hayan tenido la oportunidad de ejecutarse y adjuntar sus propios eventos.
        setTimeout(() => {
            const badge = document.getElementById('user-badge');
            const menu = document.getElementById('badge-menu');

            if (badge && menu) {
                // Esta es la función que muestra y oculta el menú.
                // Es una réplica de la lógica en renderer.js para asegurar consistencia.
                const toggleBadgeMenu = () => {
                    if (!menu.classList.contains('show')) {
                        // Si está oculto, lo mostramos
                        const rect = badge.getBoundingClientRect();
                        const top = rect.bottom + 6 + window.scrollY;
                        const left = rect.left + window.scrollX;
                        menu.style.position = 'fixed';
                        menu.style.top = `${top}px`;
                        menu.style.left = `${left}px`;
                        
                        menu.classList.remove('hidden');
                        // Forzar un reflow para que la transición se aplique
                        void menu.offsetWidth; 
                        menu.classList.add('show');
                    } else {
                        // Si está visible, lo ocultamos
                        menu.classList.remove('show');
                        // Esperamos a que la transición termine para añadir la clase 'hidden'
                        const onHide = () => {
                            menu.classList.add('hidden');
                            menu.removeEventListener('transitionend', onHide);
                        };
                        menu.addEventListener('transitionend', onHide);
                    }
                };

                // Re-asignamos el evento 'onclick' directamente.
                // Esto sobreescribe cualquier evento de clic anterior que pudiera haber sido
                // asignado y potencialmente anulado por otro script en esta página.
                badge.onclick = (e) => {
                    e.stopPropagation(); // Prevenir que el clic se propague al documento
                    toggleBadgeMenu();
                };
            }
        }, 200); // Un retraso de 200ms es generalmente seguro.
    });
    </script>
</body>  
</html>
