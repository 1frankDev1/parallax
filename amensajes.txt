-- SQL para la creación de la tabla de notificaciones en Supabase
-- Ejecuta este código en el SQL Editor de tu proyecto de Supabase

CREATE TABLE IF NOT EXISTS public.notificaciones (
    id SERIAL PRIMARY KEY,
    mensaje TEXT NOT NULL,
    tipo_destino TEXT NOT NULL, -- Valores posibles: 'all', 'roles', 'users'
    destinos JSONB DEFAULT '[]'::jsonb, -- Array de strings con roles o nombres de usuario
    emisor TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Habilitar Seguridad de Nivel de Fila (RLS)
ALTER TABLE public.notificaciones ENABLE ROW LEVEL SECURITY;

-- Política para permitir lectura a todos los usuarios autenticados
CREATE POLICY "Permitir lectura a todos"
ON public.notificaciones FOR SELECT
USING (true);

-- Política para permitir inserción solo a usuarios con rol Admin (incluyendo Admin CS, Admin Closers, etc.)
CREATE POLICY "Permitir inserción a administradores"
ON public.notificaciones FOR INSERT
WITH CHECK (true); -- En un entorno real, aquí se validaría el rol del usuario autenticado
